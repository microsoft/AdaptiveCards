<%- hashed_asset("node_modules/adaptivecards-designer/dist/adaptivecards-designer.css") %>
<%- hashed_asset("node_modules/adaptivecards/dist/adaptivecards.min.js") %>
<%- hashed_asset("node_modules/adaptive-expressions/lib/browser.js") %>
<%- hashed_asset("node_modules/adaptivecards-templating/dist/adaptivecards-templating.min.js") %>
<%- hashed_asset("node_modules/markdown-it/dist/markdown-it.min.js") %>
<%- hashed_asset("node_modules/adaptivecards-designer/dist/adaptivecards-designer.min.js") %>
<%- hashed_asset('node_modules/monaco-editor/min/vs/loader.js') %>

<style type="text/css">
    @media all and (min-width: 651px) {
		.content {
			height: calc(100vh - 97px) !important;
		}
	}

	body {
		font-family: 'Segoe UI', sans-serif;
		font-size: 14px;
	}

	#designerRootHost * {
		box-sizing: border-box;
	}

	.acd-icon-openInNewWindow::before {
		content: "\E8A7";
	}

	.acd-icon-feedback::before {
		content: "\ED15";
	}

	.acd-icon-viewOriginal::before {
		content: "\E7B4";
	}

	.acd-icon-fitPage::before {
		content: "\E9A6";
	}

	.acd-icon-storyboard::before {
		content: "\F308";
	}

	.acd-icon-scopeTemplate::before {
		content: "\F2B0";
	}

    .swiper {
      width: 100%;
      height: 100%;
    }

    .swiper-slide {
      text-align: center;
      font-size: 18px;
      background: #fff;

      /* Center slide text vertically */
      display: -webkit-box;
      display: -ms-flexbox;
      display: -webkit-flex;
      display: flex;
      -webkit-box-pack: center;
      -ms-flex-pack: center;
      -webkit-justify-content: center;
      justify-content: center;
      -webkit-box-align: center;
      -ms-flex-align: center;
      -webkit-align-items: center;
      align-items: center;
    }

	.swiper-button-next::after {
		font-family: 'Segoe Fluent Icons';
		content: "\EDDA";
	}

	.swiper-button-prev::after {
		font-family: 'Segoe Fluent Icons';
		content: "\EDD9";
	}
	
</style>


<script type="text/javascript">

	$(function () {

		function getParameterByName(name, url) {
			if (!url) {
				url = window.location.href;
			}

			name = name.replace(/[\[\]]/g, "\\$&");
			var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)");
			var results = regex.exec(url);

			if (results && results[2]) {
				return decodeURIComponent(results[2].replace(/\+/g, " "));
			} else {
				return "";
			}
		}

		function initializeDesigner() {
			let designer = new ACDesigner.CardDesigner(ACDesigner.defaultMicrosoftHosts);
			designer.assetPath = "<%- config.root %>node_modules/adaptivecards-designer/dist/";
			designer.sampleCatalogueUrl = "<%- config.root %>designer/sample-catalogue.json";
			designer.bindingPreviewMode = ACDesigner.BindingPreviewMode.SampleData;

			let hostDocsButton = new ACDesigner.ToolbarButton(
				"hostDocs",
				"Host App Docs",
				"acd-icon-storyboard",
				function () {
					window.open("https://docs.microsoft.com/en-us/adaptive-cards/resources/partners")
				}
			);
			hostDocsButton.separator = false;
			hostDocsButton.toolTip = "Learn more about the Host Apps";
			designer.toolbar.insertElementAfter(hostDocsButton, ACDesigner.CardDesigner.ToolbarCommands.HostAppPicker);

			let templateDocsButton = new ACDesigner.ToolbarButton(
				"templateDocs",
				"Templating Docs",
				"acd-icon-scopeTemplate",
				function () {
					appInsights.trackEvent({ name: "ViewedTemplatingDocs" }, { Origin: "Designer" });
					window.open("https://docs.microsoft.com/en-us/adaptive-cards/templating/");
				}
			);
			templateDocsButton.separator = false;
			templateDocsButton.toolTip = "Learn more about Adaptive Cards templating";
			designer.toolbar.insertElementAfter(templateDocsButton, "hostDocs");

			designer.toolbar.getElementById(ACDesigner.CardDesigner.ToolbarCommands.HostAppPicker).width = "auto";

			let feedbackButton = new ACDesigner.ToolbarButton(
				"feedbackButton",
				"Feedback",
				"acd-icon-feedback",
				function () {
					window.open("https://github.com/Microsoft/AdaptiveCards/issues/new?title="
						+ encodeURIComponent("[Designer] Feedback title here")
						+ "&labels=" + encodeURIComponent("Bug,Triage-Needed,Area-Designer")
						+ "&template=" + encodeURIComponent("designer-bug-report.md"))
				}
			);

			feedbackButton.separator = true;
			feedbackButton.displayCaption = false;
			feedbackButton.alignment = ACDesigner.ToolbarElementAlignment.Right;
			feedbackButton.toolTip = "Provide feedback about the Designer";
			designer.toolbar.addElement(feedbackButton);

			designer.attachTo(document.getElementById("designerRootHost"));
			designer.monacoModuleLoaded();

			var cardUrl = getParameterByName("card", null);
			var dataUrl = getParameterByName("data", null);

			if (dataUrl) {
				var dataXhttp = new XMLHttpRequest();
				dataXhttp.onload = function () {
					if (dataXhttp.responseText && dataXhttp.responseText != "") {
						var sampleData = JSON.parse(dataXhttp.responseText);
						designer.sampleData = sampleData;
					}
				};

				// TODO: when the designer has an addError API we should log that we failed to load the requested card
				// xhttp.onerror = function() {
				// 	designer.
				// };

				try {
					dataXhttp.open("GET", dataUrl, true);
					dataXhttp.send();
				} catch (e) {
				}
			} else {
				// Add sample data
				let sampleData = {
					"title": "Publish Adaptive Card Schema",
					"description": "Now that we have defined the main rules and features of the format, we need to produce a schema and publish it to GitHub. The schema will be the starting point of our reference documentation.",
					"creator": {
						"name": "Matt Hidinger",
						"profileImage": "https://pbs.twimg.com/profile_images/3647943215/d7f12830b3c17a5a9e4afcc370e3a37e_400x400.jpeg"
					},
					"createdUtc": "2017-02-14T06:08:39Z",
					"viewUrl": "https://adaptivecards.io",
					"properties": [
						{ "key": "Board", "value": "Adaptive Cards" },
						{ "key": "List", "value": "Backlog" },
						{ "key": "Assigned to", "value": "Matt Hidinger" },
						{ "key": "Due date", "value": "Not set" }
					]
				};

				designer.sampleData = sampleData;
			}

			if (cardUrl) {
				var cardXhttp = new XMLHttpRequest();
				cardXhttp.onload = function () {
					if (cardXhttp.responseText && cardXhttp.responseText != "") {
						designer.setCard(JSON.parse(cardXhttp.responseText));
					}

					// TODO: Talk to David: I want to put the sampleData setter here but it was failing

					history.replaceState(null, null, "<%- config.root %>designer");
				};

				// TODO: when the designer has an addError API we should log that we failed to load the requested card
				// xhttp.onerror = function() {
				// 	designer.
				// };

				try {
					cardXhttp.open("GET", cardUrl, true);
					cardXhttp.send();
				} catch (e) {
				}
			} else {
				designer.setCard({
	"$schema": "http://adaptivecards.io/schemas/adaptive-card.json",
	"type": "AdaptiveCard",
	"version": "1.6",
	"TBD": {
	  "type": "carousel",
	  "timer": 5000,
	  "someOtherCarouselProperty": true
	},
	"body": [
	  {
		"type": "CarouselPage",
		"id": "firstCarouselPage",
		"selectAction": {
	  	"type": "Action.OpenUrl",
	  	"title": "Click for more information about the first carousel page!",
	  	"url": "https://adaptivecards.io/"
		},
		"items": [
	  	 {
	  		"type": "Image",
	  		"url": "https://adaptivecards.io/content/cats/1.png",
	  		"size": "medium"
	  	}
		]
	  },
	  {
		"type": "CarouselPage",
		"id": "theSecondCarouselPage",
		"items": [
	  	{
	  		"type": "Image",
	  		"url": "https://adaptivecards.io/content/cats/2.png",
	  		"size": "medium"
	  	}
		]
	  },
	  {
		"type": "CarouselPage",
		"id": "last-carousel-page",
		"items": [
	  	{
	  		 "type": "Image",
	  		"url": "https://adaptivecards.io/content/cats/3.png",
	  		"altText": "That's a cool cat!",
	  		"size": "medium"
	  	}
		]
	  }
    ]
});
			}
		}

		if (!ACDesigner.SettingsManager.isLocalStorageAvailable) {
			console.log("Local storage is not available.");
		}

		ACDesigner.GlobalSettings.enableDataBindingSupport = true;
		ACDesigner.GlobalSettings.showDataStructureToolbox = false;
		ACDesigner.GlobalSettings.showSampleDataEditorToolbox = true;
		ACDesigner.GlobalSettings.showVersionPicker = true;

		<% if (page.previewFeaturesEnabled) { %>

        <% } %>


        if (getParameterByName("preview") === "1") {

        }

		require.config({
			paths: {
				'vs': '<%- config.root %>node_modules/monaco-editor/min/vs'
			}
		});
		require(['vs/editor/editor.main'], function () {
			// Override the designer schema validation to enable syntax highlighting
			// TODO: Find a way to also validate against the schema
			monaco.languages.json.jsonDefaults.setDiagnosticsOptions({
				validate: true
			});

			initializeDesigner();
		});
	});
</script>

<div style="display: flex; flex-direction: column; height: 100%; ">
	<div id="designerRootHost"></div>
</div>
